<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HMM_tutorial - 4&nbsp; Case studies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./continuous_HMMs.html" rel="next">
<link href="./hidden_states.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./case_studies.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Case studies</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">HMM_tutorial</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fitting a HMM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hidden_states.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Predicting hidden states</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case_studies.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./continuous_HMMs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Continuous Hidden Markov Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#river-geomorphology-example" id="toc-river-geomorphology-example" class="nav-link active" data-scroll-target="#river-geomorphology-example"><span class="header-section-number">4.1</span> River geomorphology example</a>
  <ul class="collapse">
  <li><a href="#description-of-the-dataset" id="toc-description-of-the-dataset" class="nav-link" data-scroll-target="#description-of-the-dataset"><span class="header-section-number">4.1.1</span> Description of the dataset</a></li>
  <li><a href="#fit-of-a-hmm" id="toc-fit-of-a-hmm" class="nav-link" data-scroll-target="#fit-of-a-hmm"><span class="header-section-number">4.1.2</span> Fit of a HMM</a></li>
  <li><a href="#discussion-hmm-segmentation-vs-clustering" id="toc-discussion-hmm-segmentation-vs-clustering" class="nav-link" data-scroll-target="#discussion-hmm-segmentation-vs-clustering"><span class="header-section-number">4.1.3</span> Discussion: HMM segmentation vs clustering</a></li>
  </ul></li>
  <li><a href="#textual-analysis-example" id="toc-textual-analysis-example" class="nav-link" data-scroll-target="#textual-analysis-example"><span class="header-section-number">4.2</span> Textual analysis example</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Case studies</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="river-geomorphology-example" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="river-geomorphology-example"><span class="header-section-number">4.1</span> River geomorphology example</h2>
<section id="description-of-the-dataset" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="description-of-the-dataset"><span class="header-section-number">4.1.1</span> Description of the dataset</h3>
<p>Let’s consider a qualitative geomorphological descriptor a river. This indicator has been built through a hierarchical clustering analysis based on several quantitative variables, namely:</p>
<ul>
<li><strong>f.slope</strong>: log(slope)</li>
<li><strong>f.sinuosity</strong>: log(sinuosity -1)</li>
<li><strong>f.vall_bott_W</strong>: log(valley bottom width)</li>
<li><strong>f.wat_cov</strong>: logit(area under water divided by area of the active channel)</li>
<li><strong>f.act_chan_cov</strong>: log(area of the active channel divided by catchment area)</li>
<li><strong>f.act_chan_vW</strong>: log(interquartile range of active channel width)</li>
</ul>
<p>The individuals are homogeneous reaches of average length 1.7km.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data_river <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/data_river.csv"</span>, <span class="at">sep=</span><span class="st">";"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(data_river)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_river)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ade4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : ade4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">=</span>data_river[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(data_river)]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>datascaled<span class="ot">=</span><span class="fu">scale</span>(data,<span class="at">center=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#boxplot(datascaled)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>monACP<span class="ot">=</span><span class="fu">dudi.pca</span>(data,<span class="at">scannf=</span><span class="cn">FALSE</span>,<span class="at">nf=</span><span class="dv">2</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>tree<span class="ot">=</span><span class="fu">hclust</span>(<span class="fu">dist</span>(datascaled), <span class="at">method=</span><span class="st">"ward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>La méthode "ward" a été renommée "ward.D"; notez la nouvelle méthode "ward.D2"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lcol2<span class="ot">=</span><span class="fu">c</span>(<span class="st">"darkorchid"</span>,<span class="st">"palegreen"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lcol5<span class="ot">=</span><span class="fu">c</span>(<span class="st">"slateblue2"</span>,<span class="st">"maroon1"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">"gold1"</span>,<span class="st">"darkolivegreen1"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"mediumaquamarine"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(tree)grouping5=as.factor(cutree(tree,k=5))</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>grouping5<span class="ot">=</span><span class="fu">as.factor</span>(<span class="fu">cutree</span>(tree,<span class="at">k=</span><span class="dv">5</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>grouping2<span class="ot">=</span><span class="fu">as.factor</span>(<span class="fu">cutree</span>(tree,<span class="at">k=</span><span class="dv">2</span>))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>series5<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">"class"</span>,grouping5)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>series2<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">"class"</span>,grouping2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" width="8" height="6">
<div class="cell-output-display">
<div id="fig-classesdescription" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-classesdescription-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.1: Description of classes. A Principal Component Analysis has been performed to help with the description.</figcaption>
</figure>
</div>
</div>
</div>
<p>Figure <a href="#fig-classesdescription">Figure&nbsp;<span>4.1</span></a> shows the quantitative geomorphological features of the 5 classes defined through hierarchical clustering.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-seqclasses" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-seqclasses-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption class="figure-caption">Figure&nbsp;4.2: Description of classes</figcaption>
</figure>
</div>
</div>
</div>
<p>Figure <a href="#fig-seqclasses">Figure&nbsp;<span>4.2</span></a> displays the sequence of classes along the river.</p>
</section>
<section id="fit-of-a-hmm" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="fit-of-a-hmm"><span class="header-section-number">4.1.2</span> Fit of a HMM</h3>
<p>We hypothesize that there are actually two hidden states (let’s call them “A” and “B”) behind the observed sequence of series). The proportions of classes in the observation series is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>myprop<span class="ot">=</span><span class="fu">round</span>(<span class="fu">table</span>(series5)<span class="sc">/</span><span class="fu">length</span>(series5),<span class="dv">2</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(myprop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>series5
class1 class2 class3 class4 class5 
  0.25   0.11   0.29   0.25   0.09 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>myprop<span class="ot">=</span><span class="fu">as.vector</span>(myprop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We initialize the emission matrix and transition matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>M_E<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(myprop[<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>,myprop[<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>             myprop[<span class="dv">2</span>]<span class="sc">-</span><span class="fl">0.05</span>,myprop[<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>             myprop[<span class="dv">3</span>]<span class="sc">+</span><span class="fl">0.05</span>,myprop[<span class="dv">3</span>]<span class="sc">-</span><span class="fl">0.05</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>             myprop[<span class="dv">4</span>]<span class="sc">-</span><span class="fl">0.05</span>,myprop[<span class="dv">4</span>]<span class="sc">+</span><span class="fl">0.05</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>             myprop[<span class="dv">5</span>]<span class="sc">+</span><span class="fl">0.05</span>,myprop[<span class="dv">5</span>]<span class="sc">-</span><span class="fl">0.05</span>),<span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_E)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_E)<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">"class"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>M_E</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  class1 class2 class3 class4 class5
A    0.3   0.06   0.34    0.2   0.14
B    0.2   0.16   0.24    0.3   0.04</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>M_T<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(.<span class="dv">9</span>,.<span class="dv">1</span>,.<span class="dv">1</span>,.<span class="dv">9</span>),<span class="dv">2</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_T)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_T)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>M_T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    A   B
A 0.9 0.1
B 0.1 0.9</code></pre>
</div>
</div>
<p>Thus we can initialize the HMM :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>initial_HMM<span class="ot">=</span><span class="fu">initHMM</span>(<span class="at">States=</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Symbols=</span><span class="fu">paste0</span>(<span class="st">"class"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">transProbs=</span>M_T,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">emissionProbs=</span>M_E)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now fit the HMM model using this initial parameterization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>hmm_fit<span class="ot">=</span> <span class="fu">baumWelch</span>(initial_HMM,series5,<span class="at">maxIterations=</span><span class="dv">100</span>)<span class="sc">$</span>hmm</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>colstates<span class="ot">=</span><span class="fu">c</span>(<span class="st">"cadetblue3"</span>,<span class="st">"sienna2"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(hmm_fit<span class="sc">$</span>emissionProbs,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      symbols
states class1 class2 class3 class4 class5
     A    0.6   0.13   0.03   0.06   0.18
     B    0.0   0.10   0.48   0.40   0.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(hmm_fit<span class="sc">$</span>transProbs,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    to
from    A    B
   A 0.93 0.07
   B 0.04 0.96</code></pre>
</div>
</div>
<p>Figure <a href="#fig-hmmfit">Figure&nbsp;<span>4.3</span></a> illustrates the differences between states A and B: A is characterized by a frequent occurence of classes 3 and 4 while B is characterized by a frequent occurence of classes 1, 2 and 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">1</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(hmm_fit<span class="sc">$</span>emissionProbs, <span class="at">col=</span>lcol5)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(hmm_fit<span class="sc">$</span>transProbs, <span class="at">col=</span>colstates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-hmmfit" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-hmmfit-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;4.3: Fitted parameters of the HMM.</figcaption>
</figure>
</div>
</div>
</div>
<p>Now, we use the fitted HMM to infer the hidden states series:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>seriesHMM<span class="ot">=</span><span class="fu">as.factor</span>(<span class="fu">viterbi</span>(hmm_fit,series5))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-statesandobs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-statesandobs-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;4.4: 1) observation series (classification into 5 clusters based on quantitative variables) 2) hidden states series (classification into two states based on observation series consisting of 5 possible clusters).</figcaption>
</figure>
</div>
</div>
</div>
<p>Figure <a href="#fig-statesandobs">Figure&nbsp;<span>4.4</span></a> displays the observation and estimated states series.</p>
</section>
<section id="discussion-hmm-segmentation-vs-clustering" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="discussion-hmm-segmentation-vs-clustering"><span class="header-section-number">4.1.3</span> Discussion: HMM segmentation vs clustering</h3>
<p>A HMM is primarily designed to describe the sequence of hidden states underlying the observation of a <em>series</em>. Doing so, it cuts a qualitative signal into homogeneous segments.</p>
<p>In this example, the data at hand has been used to first define 5 classes, and then a HMM model has been carried out to define 2 states based on these 5 classes. One can wonder why not define 2 classes directly.</p>
<p>Actually, these two methods, although they seemingly result in the same kind of output (i.e.&nbsp;a 2-classes segmentation of the river) do not proceed according to the same principles.</p>
<p>Hierarchical clustering makes no direct use in the geographical information in the data. The fact that two successive reaches fall into the same class is only due to the fact that two reaches tend to have similar geomorphological descriptions when they are close to each other.</p>
<p>On the other hand, a HMM model uses both geomorphological descriptors AND geographical information (i.e.&nbsp;the location of reaches in the sequence) to define which state they are most likely to result from.</p>
<p>To illustrate this we will use the quantitative data at hand to define a 2-classes description based on a hierarchical clustering. Figure <a href="#fig-comparison2classes">Figure&nbsp;<span>4.5</span></a> shows the characteristics of these 2 classes as well as the characteristics of reaches occurring presumably in states A and B.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-comparison2classes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-comparison2classes-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Figure&nbsp;4.5: Comparison of 1) classes (output of hierarchical clustering with 2 classes) and 2) hidden states as estimated based on a HMM model.</figcaption>
</figure>
</div>
</div>
</div>
<p>Figure <a href="#fig-comparison2classes">Figure&nbsp;<span>4.5</span></a> illustrates the closeness (in terms of descriptors) of classes either inferred (based on several quantitative variables) through hierarchical clustering and states based on a 5-classes descriptor as defined through a HMM model fit.</p>
<p>On the other hand, figure <a href="#fig-series3types">Figure&nbsp;<span>4.6</span></a> shows that there are some differences between segments either defined as the projection of the 2-classes categorization along the river (for hierarchical clustering) or defined as the most probable states path (for HMM). Taking into account the geographical succession of reaches and not only geomorphological features, the HMM path provides a less fragmented segmentation.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-series3types" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-series3types-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;4.6: Comparison of 1) observation series (classification into 5 clusters based on quantitative variables) 2) observation series (classification into 2 clusters based on quantitative variables) 3) hidden states series (classification into two states based on observation series consisting of 5 possible clusters).</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="textual-analysis-example" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="textual-analysis-example"><span class="header-section-number">4.2</span> Textual analysis example</h2>
<p>Let’s consider an extract of a Sherlock Holmes novel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>text<span class="ot">=</span><span class="fu">scan</span>(<span class="st">"data/sherlock.txt"</span>, <span class="at">what=</span><span class="st">"raw"</span>, <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(text))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 776</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(text[<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "To"           "Sherlock"     "Holmes"       "she"          "is"          
 [6] "always"       "the"          "woman"        "."            "I"           
[11] "have"         "seldom"       "heard"        "him"          "mention"     
[16] "her"          "under"        "any"          "other"        "name"        
[21] "."            "In"           "his"          "eyes"         "she"         
[26] "eclipses"     "and"          "predominates" "the"          "whole"       </code></pre>
</div>
</div>
<p>We are interested in distinguishing the parts where the focus is mainly on Sherlock Holmes, to parts where the attention is mainly focused on the narrator, Dr Watson. We want to do this on all Sherlock Holmes novels so that this distinction should be done automatically (though here we will only use a short extract as an example).</p>
<p>We categorize words into 3 categories:</p>
<ul>
<li>a neutral category (outcome “blah”)</li>
<li>a Sherlock Holmes-centered category (outome “he”)</li>
<li>a John Watson-centered category (outcome “I”)</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>           text observations
1            To         blah
2      Sherlock           he
3        Holmes           he
4           she         blah
5            is         blah
6        always         blah
7           the         blah
8         woman         blah
9             .         blah
10            I            I
11         have         blah
12       seldom         blah
13        heard         blah
14          him           he
15      mention         blah
16          her         blah
17        under         blah
18          any         blah
19        other         blah
20         name         blah
21            .         blah
22           In         blah
23          his           he
24         eyes         blah
25          she         blah
26     eclipses         blah
27          and         blah
28 predominates         blah
29          the         blah
30        whole         blah</code></pre>
</div>
</div>
<p>Figure <a href="#fig-seqwords">Figure&nbsp;<span>4.7</span></a> shows how the sequence of outcomes looks like for our example.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-seqwords" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-seqwords-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Figure&nbsp;4.7: The observation series: each point corresponds to a word in a text. Blue points correspond to an occurrence of an ‘I’ outcome, while red points correspond to an occurrence of a ‘he’ outcome.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>myprop<span class="ot">=</span><span class="fu">table</span>(observations)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>myprop<span class="ot">=</span>myprop<span class="sc">/</span><span class="fu">sum</span>(myprop)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(myprop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>observations
      blah         he          I 
0.90592784 0.06185567 0.03221649 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>myprop<span class="ot">=</span><span class="fu">as.vector</span>(myprop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We initialize the emission matrix stating that occurrence of the “he” outcome should be more frequent in the Holmes-centered parts while the “I” will be more frequent in the Watson-centered parts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>M_E<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(myprop[<span class="dv">1</span>], myprop[<span class="dv">1</span>],</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>             myprop[<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.01</span>, myprop[<span class="dv">2</span>]<span class="sc">-</span><span class="fl">0.01</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>             myprop[<span class="dv">3</span>]<span class="sc">-</span><span class="fl">0.01</span>, myprop[<span class="dv">3</span>]<span class="sc">+</span><span class="fl">0.01</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_E)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Holmes"</span>,<span class="st">"Watson"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_E)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"blah"</span>,<span class="st">"he"</span>,<span class="st">"I"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We initialize the transition matrix stating that transition from a state to another happens about 1 time out of 100 words:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>M_T<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.99</span>,<span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.99</span>),<span class="dv">2</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_T)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Holmes"</span>,<span class="st">"Watson"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_T)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Holmes"</span>,<span class="st">"Watson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The initial HMM is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>initial_HMM<span class="ot">=</span><span class="fu">initHMM</span>(<span class="at">States=</span><span class="fu">c</span>(<span class="st">"Holmes"</span>,<span class="st">"Watson"</span>),</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Symbols=</span><span class="fu">c</span>(<span class="st">"blah"</span>,<span class="st">"he"</span>,<span class="st">"I"</span>),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">transProbs=</span>M_T,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">emissionProbs=</span>M_E)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now fit the HMM model using this initial parameterization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>hmm_fit<span class="ot">=</span> <span class="fu">baumWelch</span>(initial_HMM,observations,<span class="at">maxIterations=</span><span class="dv">100</span>)<span class="sc">$</span>hmm</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>col_outcomes<span class="ot">=</span><span class="fu">c</span>(<span class="st">"grey"</span>,<span class="st">"red"</span>,<span class="st">"blue"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>col_states<span class="ot">=</span><span class="fu">c</span>(<span class="st">"pink2"</span>,<span class="st">"skyblue3"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit<span class="sc">$</span>emissionProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        symbols
states   blah   he    I
  Holmes 0.91 0.07 0.02
  Watson 0.90 0.00 0.10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit<span class="sc">$</span>transProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        to
from     Holmes Watson
  Holmes   1.00   0.00
  Watson   0.01   0.99</code></pre>
</div>
</div>
<p>The characteristics of states “Holmes” and “Watson” are displayed in figure <a href="#fig-hmmfit2">Figure&nbsp;<span>4.8</span></a>. Watson (outcome “I”), as a narrator, never completely disappears from the text even in Holmes-centered parts, while Watson-parts are characterized by a null occurrence of outcome “he”.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hmmfit2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-hmmfit2-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;4.8: Fitted parameters of the HMM.</figcaption>
</figure>
</div>
</div>
</div>
<p>Now, we use the fitted HMM to infer the hidden states series:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>states_speech<span class="ot">=</span><span class="fu">as.factor</span>(<span class="fu">viterbi</span>(hmm_fit,observations))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-words" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="case_studies_files/figure-html/fig-words-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;4.9: Observation series and state series.</figcaption>
</figure>
</div>
</div>
</div>
<p>Figure <a href="#fig-words">Figure&nbsp;<span>4.9</span></a> displays the observation and estimated states series. There is only one part of the text which appears to be Watson-centered (according to how Watson-centerization is defined, i.e.&nbsp;total disappearance of “he” outcomes.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(text[states_speech<span class="sc">==</span><span class="st">"Watson"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "I"          "merely"     "shared"     "with"       "all"       
 [6] "the"        "readers"    "of"         "the"        "daily"     
[11] "press"      ","          "I"          "knew"       "little"    
[16] "of"         "my"         "former"     ""           "friend"    
[21] "and"        "companion"  "."          "One"        "night"     
[26] "-"          "it"         "was"        "on"         "the"       
[31] "twentieth"  "of"         "March"      ","          "1888"      
[36] "-"          "I"          "was"        "returning"  "from"      
[41] "a"          "journey"    "to"         "a"          "patient"   
[46] "("          "for"        "I"          "had"        "now"       
[51] "returned"   "to"         "civil"      "practice"   ")"         
[56] ","          "when"       "my"         "way"        "led"       
[61] "me"         "through"    "Baker"      "Street"     "."         
[66] "As"         "I"          "passed"     "the"        "well"      
[71] "-"          "remembered" "door"       ","          "which"     
[76] "must"       "always"     "be"         "associated" "in"        
[81] "my"         "mind"       "with"       "my"         "wooing"    
[86] ","          "and"        "with"       "the"        "dark"      
[91] "incidents"  "of"         "the"        "Study"      "in"        
[96] "Scarlet"    ","          "I"         </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./hidden_states.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Predicting hidden states</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./continuous_HMMs.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Continuous Hidden Markov Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>