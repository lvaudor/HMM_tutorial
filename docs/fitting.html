<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HMM_tutorial - 2&nbsp; Fitting a HMM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./hidden_states.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./fitting.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fitting a HMM</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">HMM_tutorial</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fitting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fitting a HMM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hidden_states.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Predicting hidden states</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Case studies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-baum-welch-algorithm" id="toc-the-baum-welch-algorithm" class="nav-link active" data-scroll-target="#the-baum-welch-algorithm"><span class="header-section-number">2.1</span> The Baum-Welch algorithm</a>
  <ul class="collapse">
  <li><a href="#forward-and-backward-procedures" id="toc-forward-and-backward-procedures" class="nav-link" data-scroll-target="#forward-and-backward-procedures"><span class="header-section-number">2.1.1</span> Forward and backward procedures</a></li>
  <li><a href="#probability-of-states" id="toc-probability-of-states" class="nav-link" data-scroll-target="#probability-of-states"><span class="header-section-number">2.1.2</span> Probability of states</a></li>
  <li><a href="#estimates-of-parameters" id="toc-estimates-of-parameters" class="nav-link" data-scroll-target="#estimates-of-parameters"><span class="header-section-number">2.1.3</span> Estimates of parameters</a></li>
  </ul></li>
  <li><a href="#fitting-a-hmm-in-practice" id="toc-fitting-a-hmm-in-practice" class="nav-link" data-scroll-target="#fitting-a-hmm-in-practice"><span class="header-section-number">2.2</span> Fitting a HMM in practice</a></li>
  <li><a href="#effect-of-parameter-initialization" id="toc-effect-of-parameter-initialization" class="nav-link" data-scroll-target="#effect-of-parameter-initialization"><span class="header-section-number">2.3</span> Effect of parameter initialization</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-baumwelch" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fitting a HMM</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
<section id="the-baum-welch-algorithm" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="the-baum-welch-algorithm"><span class="header-section-number">2.1</span> The Baum-Welch algorithm</h2>
<p>The Baum–Welch algorithm is used to find the unknown parameters <span class="math inline">\(\theta = (T,E,\pi)\)</span> of a HMM, which maximizes the probability of the observation series.</p>
<p><span class="math display">\[
\widehat\theta = \max_{\theta} pr(X/\theta)
\]</span></p>
<p>Let’s consider random initial values (or values set according to prior knowledge) for <span class="math inline">\(\theta\)</span>: <span class="math inline">\(\theta_0 = (T_0, E_0, \pi)\)</span>.</p>
<section id="forward-and-backward-procedures" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="forward-and-backward-procedures"><span class="header-section-number">2.1.1</span> Forward and backward procedures</h3>
<div id="fig-forward-backward" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/forward-backward.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2.1: Forward and backward probabilities</figcaption>
</figure>
</div>
<p><strong>Forward procedure</strong></p>
<p><span class="math display">\[
\alpha_i(k)=pr(X_1=x_1,...,X_k=x_k,S_k=i/\theta)
\]</span></p>
<p>is the probability of getting the “beginning” of the observation series <span class="math inline">\(x_1,x_2,...,x_k\)</span> and having <span class="math inline">\(i\)</span> as ending state (at time <span class="math inline">\(k\)</span>) given parameters <span class="math inline">\(\theta\)</span>.</p>
<p><span class="math inline">\(\alpha_i(k)\)</span> is calculated recursively, with: <span class="math display">\[
\alpha_i(1)=\pi_i e_{ix_1}\\
\alpha_j(k+1)=e_{jx_{k+1}} \sum_{i=1}^{n_S}\alpha_i(k) t_{ij}
\]</span></p>
<p>Indeed, the probability of the series <span class="math inline">\(x_1,x_2,...,x_k+1\)</span> and state <span class="math inline">\(j\)</span> at time <span class="math inline">\(k+1\)</span> is the probability that (considering all possible states <span class="math inline">\(i\)</span> at time <span class="math inline">\(k\)</span>):</p>
<ul>
<li>the first <span class="math inline">\(k\)</span> observations were <span class="math inline">\(x_1,x_2,...,x_k\)</span> and the state was <span class="math inline">\(i\)</span> at time <span class="math inline">\(k\)</span><br>
</li>
<li>there has been a transition from state <span class="math inline">\(i\)</span> to state <span class="math inline">\(j\)</span> at time <span class="math inline">\(k\)</span></li>
<li>the outcome at time <span class="math inline">\(k+1\)</span> is <span class="math inline">\(x_k+1\)</span></li>
</ul>
<p><strong>Backward procedure</strong></p>
<p><span class="math display">\[
\beta_i(k)=pr(X_{k+1}=x_{k+1},...,X_n=x_n/S_k=i,\theta)
\]</span> is the probability of getting the “ending” of the observation series <span class="math inline">\(x_{k+1},...,x_{n}\)</span> and <span class="math inline">\(i\)</span> as starting state (at time <span class="math inline">\(k\)</span>) given parameters <span class="math inline">\(\theta\)</span>.</p>
<p><span class="math inline">\(\beta_i(k)\)</span> is calculated recursively, with: <span class="math display">\[
\beta_i(T)=1\\
\beta_i(k)=\sum_{j=1}^{n_S} \beta_j(k+1)t_{ij}e_j(x_{k+1})
\]</span></p>
<p>Indeed, the probability of the series <span class="math inline">\(x_{k},x_{k+1},...,x_n\)</span> and state <span class="math inline">\(i\)</span> at time <span class="math inline">\(k\)</span> is the probability that (considering all possible states <span class="math inline">\(j\)</span> at time <span class="math inline">\(k+1\)</span>):</p>
<ul>
<li>the last <span class="math inline">\(n-k\)</span> observations were <span class="math inline">\(x_{k+1},...,x_n\)</span> and the state was <span class="math inline">\(j\)</span> at time <span class="math inline">\(k+1\)</span><br>
</li>
<li>there has been a transition from state <span class="math inline">\(i\)</span> to state <span class="math inline">\(j\)</span> at time <span class="math inline">\(k\)</span></li>
<li>the outcome at time <span class="math inline">\(k+1\)</span> is <span class="math inline">\(x_k+1\)</span></li>
</ul>
<p>The forward and backward procedures are illustrated in figure <a href="#fig-forward-backward">Figure&nbsp;<span>2.1</span></a>.</p>
</section>
<section id="probability-of-states" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="probability-of-states"><span class="header-section-number">2.1.2</span> Probability of states</h3>
<p>We can now calculate the probability of being in state <span class="math inline">\(i\)</span> at time <span class="math inline">\(k\)</span> given the observed sequence <span class="math inline">\(X\)</span> and parameters <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\gamma_i(k)=pr(S_k=i/X,\theta)\)</span>.</p>
<p>Indeed, according to Bayes’s formula,</p>
<p><span class="math display">\[
pr(S_k=i/X,\theta)=\frac{pr(X,S_k=i/\theta)pr(\theta)}{pr(X,\theta)}
\]</span></p>
<p><span class="math display">\[
=\frac{pr(X,S_k=i/\theta)pr(\theta)}{pr(X/\theta)pr(\theta)}
\]</span> <span id="eq-eqnSk"><span class="math display">\[
=\frac{pr(X,S_k=i/\theta)}{pr(X/\theta)}
\tag{2.1}\]</span></span></p>
<p>and we have</p>
<p><span class="math display">\[
pr(X,S_k=i/\theta) = pr(X_1,X_2,....X_k,S_k=i/\theta)* pr(X_{k+1},X_{k+2},....X_n,S_{k+1}=j/\theta)
\]</span></p>
<p><span id="eq-eq1"><span class="math display">\[
= \alpha_i(k)\beta_i(k)
\tag{2.2}\]</span></span></p>
<p>Summing this probability for all possible states at time <span class="math inline">\(k\)</span> we get:</p>
<p><span class="math display">\[
pr(X/\theta) = \sum_{m=1}^{n_S}pr(X,S_k=m)/\theta)
\]</span></p>
<p><span id="eq-eq2"><span class="math display">\[
= \sum_{m=1}^{n_S}\alpha_m(k)\beta_m(k)    
\tag{2.3}\]</span></span></p>
<p>Hence with results <a href="#eq-eq1">Equation&nbsp;<span>2.2</span></a> and <a href="#eq-eq2">Equation&nbsp;<span>2.3</span></a> we can simplify equation <a href="#eq-eqnSk">Equation&nbsp;<span>2.1</span></a> into:</p>
<p><span class="math display">\[
\gamma_i(k) = pr(S_k=i/X,\theta)
\]</span> <span class="math display">\[
= \frac{\alpha_i(k)\beta_i(k)}
                {\sum_{m=1}^{n_S}\alpha_m(k)\beta_m(k)}
\]</span> We can now calculate the probability of being in state <span class="math inline">\(i\)</span> at time <span class="math inline">\(k\)</span> given the observed sequence <span class="math inline">\(X\)</span> and parameters <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\gamma_i(k)=pr(S_k=i/X,\theta)\)</span>.</p>
<p>The probability of being in state <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> at times <span class="math inline">\(k\)</span> and <span class="math inline">\(k+1\)</span> respectively given the observed sequence <span class="math inline">\(X\)</span> and parameters <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\xi_{ij}(k)=pr(S_k=i,S_{k+1}=j/X,\theta)\)</span>.</p>
<p>Indeed, according to Bayes’s formula</p>
<p><span class="math display">\[
pr(S_k=i,S_{k+1}=j/X,\theta)=\frac{pr(X,S_k(i),S_{k+1}=j/\theta)pr(\theta)}{pr(X,\theta)}
\]</span></p>
<p><span class="math display">\[
=\frac{pr(X,S_k(i),S_{k+1}=j/\theta)pr(\theta)}
                                  {pr(X/\theta)pr(\theta)}
\]</span> <span id="eq-eqnSkSkp1"><span class="math display">\[
=\frac{pr(X,S_k(i),S_{k+1}=j/\theta)}                             {pr(X/\theta)}
\tag{2.4}\]</span></span></p>
<p>and we can reformulate the probability of observations and successive states at times <span class="math inline">\(k\)</span> and <span class="math inline">\(k+1\)</span> the following way:</p>
<p><span class="math display">\[
pr(X,S_k=i,S_{k+1}=j)/\theta) = pr(X_1,X_2,...,X_k, S_k=i/\theta)* pr(X_{k+1}, S_k=i, S_{k+1}=j/\theta)*pr(X_{k+2},X_{k+3},...,X_n, S_k+1=j/\theta)
\]</span></p>
<p><span id="eq-eq3"><span class="math display">\[
= \alpha_i(k)t_{ij}e_{jx_{k+1}}\beta_j(k+1)
\tag{2.5}\]</span></span></p>
<p>Hence with results <a href="#eq-eq3">Equation&nbsp;<span>2.5</span></a> and <a href="#eq-eq2">Equation&nbsp;<span>2.3</span></a> we can simplify equation <a href="#eq-eqnSkSkp1">Equation&nbsp;<span>2.4</span></a> into:</p>
<p><span class="math display">\[
\xi_{ij}(k) = pr(S_k=i,S_{k+1}=j/X,\theta)
\]</span></p>
<p><span class="math display">\[
= \frac{\alpha_i(k)t_{ij}e_{jx_{k+1}}\beta_j(k+1)}
                {\sum_{m=1}^{n_S}\alpha_m(k)\beta_m(k)}       
\]</span></p>
</section>
<section id="estimates-of-parameters" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="estimates-of-parameters"><span class="header-section-number">2.1.3</span> Estimates of parameters</h3>
<p>The expected frequency spent in state i at time 1 is: <span class="math display">\[
\widehat{\pi_i} = \gamma_i(1)
\]</span></p>
<p>The expected transition probability from state <span class="math inline">\(i\)</span> to state <span class="math inline">\(j\)</span> is equal to the expected frequency of states <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> at two successive times, divided by the expected frequency of state <span class="math inline">\(i\)</span>.</p>
<p><span class="math display">\[
\widehat{t_{ij}}=\frac{\sum^{n-1}_{k=1}\xi_{ij}(k)}{\sum^{n-1}_{k=1}\gamma_i(k)}
\]</span></p>
<p>The expected emission frequency of outcome <span class="math inline">\(x\)</span> from state <span class="math inline">\(i\)</span> is equal to the frequency of state i and outcome <span class="math inline">\(x\)</span> occurring at the same time over the expected frequency of state <span class="math inline">\(i\)</span>.</p>
<p><span class="math display">\[
\widehat{e_{ix}}=\frac{\sum^n_{k=1} 1_{X_k=x} \gamma_i(k)}{\sum^n_{k=1} \gamma_i(k)}
\]</span></p>
<p>As a consequence, based on <span class="math inline">\(X\)</span> and <span class="math inline">\(\theta_0\)</span> (corresponding to the initial transition and emission probabilities), we can calculate and expected value <span class="math inline">\(\hat\theta\)</span> (corresponding to transition and emission probabilities that are consistent both with observations and hypothesized values of <span class="math inline">\(\theta\)</span>).</p>
<ul>
<li>We set <span class="math inline">\(\theta=\theta_0\)</span> and based on these parameters calculate <span class="math inline">\(\theta_1=\hat\theta\)</span></li>
<li>We set <span class="math inline">\(\theta=\theta_1\)</span> and based on these parameters calculate <span class="math inline">\(\theta_2=\hat\theta\)</span></li>
<li>etc.</li>
</ul>
<p>This process is repeated until a desired level of convergence, i.e.&nbsp;until<span class="math inline">\(|\hat\theta-\theta|\)</span> is below a certain threshold. Indeed, the lower <span class="math inline">\(|\hat\theta-\theta|\)</span>, the closer <span class="math inline">\(\hat\theta\)</span> is to a <strong>local optimum for <span class="math inline">\(\theta\)</span></strong>. Note that the algorithm does not guarantee a global maximum.</p>
</section>
</section>
<section id="fitting-a-hmm-in-practice" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="fitting-a-hmm-in-practice"><span class="header-section-number">2.2</span> Fitting a HMM in practice</h2>
<p>Let’s go back to the wood occurrence series. We will use the Baum-Welch algorithm to fit a HMM with two hidden states, H and L, defined as “High occurrence frequency state” and “Low occurrence frequency state”. To do this, we will use the function “baumWelch” from the “HMM” R package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HMM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we have seen, the Baum-Welch algorithm iteratively adjusts the parameter values <span class="math inline">\(\theta\)</span> to maximize likelihood. Thus we have to <em>initialize</em> the algorithm with a prior estimate of <span class="math inline">\(\theta\)</span>.</p>
<p>We could, for instance, consider that the two states we are interested in are not very contrasted (let’s talk of uncontrasted states -UCS- from now on), and that transition probabilities are quite low (low transition probabilities: LTP). Here, we will hence consider that the H state is characterized by +5% chances of getting wood, and the L state is characterized by -5% chances of getting wood (compared to the overal frequency of 46.81%).</p>
<p>Thus we can write the “UCS” emission matrix this way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>M_UCS<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>(pw<span class="fl">-0.05</span>),<span class="dv">1</span><span class="sc">-</span>(pw<span class="fl">+0.05</span>),pw<span class="fl">-0.05</span>,(pw<span class="fl">+0.05</span>)),<span class="dv">2</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_UCS)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_UCS)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"nothing"</span>,<span class="st">"wood"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(M_UCS,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  nothing wood
L    0.58 0.42
H    0.48 0.52</code></pre>
</div>
</div>
<p>We will also consider that at each time, there is only 10% chances to change from state L to state H, or from state H to state L.</p>
<p>Thus we can write the “LTP” transition matrix this way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>M_LTP<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(.<span class="dv">9</span>,.<span class="dv">1</span>,.<span class="dv">1</span>,.<span class="dv">9</span>),<span class="dv">2</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_LTP)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_LTP)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(M_LTP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    L   H
L 0.9 0.1
H 0.1 0.9</code></pre>
</div>
</div>
<p>The initialization of the HMM is done through:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>initial_HMM<span class="ot">=</span><span class="fu">initHMM</span>(<span class="at">States=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>),</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Symbols=</span><span class="fu">c</span>(<span class="st">"nothing"</span>,<span class="st">"wood"</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">transProbs=</span>M_LTP,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">emissionProbs=</span>M_UCS)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(initial_HMM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$States
[1] "L" "H"

$Symbols
[1] "nothing" "wood"   

$startProbs
  L   H 
0.5 0.5 

$transProbs
    to
from   L   H
   L 0.9 0.1
   H 0.1 0.9

$emissionProbs
      symbols
states   nothing      wood
     L 0.5819149 0.4180851
     H 0.4819149 0.5180851</code></pre>
</div>
</div>
<p>i.e.&nbsp;the states (L or H), and outcomes (“nothing” or “wood”) are defined, and initial values are set to the transition and emission matrices.</p>
<p>The various elements of the object <code>initial_HMM</code> can be accessed (as is the usual way with R lists) through:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(initial_HMM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "States"        "Symbols"       "startProbs"    "transProbs"   
[5] "emissionProbs"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(initial_HMM<span class="sc">$</span>emissionProbs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      symbols
states   nothing      wood
     L 0.5819149 0.4180851
     H 0.4819149 0.5180851</code></pre>
</div>
</div>
<p>Then the optimization can be carried out through:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hmm_fit_1<span class="ot">=</span> <span class="fu">baumWelch</span>(initial_HMM,obsWood,<span class="at">maxIterations=</span><span class="dv">100</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hmm_fit_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$hmm
$hmm$States
[1] "L" "H"

$hmm$Symbols
[1] "nothing" "wood"   

$hmm$startProbs
  L   H 
0.5 0.5 

$hmm$transProbs
    to
from         L          H
   L 0.9151896 0.08481042
   H 0.1010682 0.89893176

$hmm$emissionProbs
      symbols
states    nothing      wood
     L 0.89814860 0.1018514
     H 0.08898919 0.9110108


$difference
 [1] 2.066096e-01 3.033430e-01 1.627027e-01 6.527756e-02 2.941533e-02
 [6] 1.453277e-02 7.758297e-03 4.420073e-03 2.671842e-03 1.698925e-03
[11] 1.121976e-03 7.599168e-04 5.228788e-04 3.632509e-04 2.538315e-04
[16] 1.780077e-04 1.251125e-04 8.805983e-05 6.203723e-05 4.373093e-05
[21] 3.083901e-05 2.175362e-05 1.534776e-05 1.082969e-05 7.642364e-06
[26] 5.393471e-06 3.806534e-06 2.686619e-06 1.896241e-06 1.338409e-06
[31] 9.446910e-07 6.667992e-07 4.706559e-07 3.322112e-07 2.344913e-07
[36] 1.655162e-07 1.168302e-07 8.246518e-08 5.820851e-08 4.108684e-08
[41] 2.900142e-08 2.047085e-08 1.444951e-08 1.019930e-08 7.199249e-09
[46] 5.081653e-09 3.586915e-09 2.531860e-09 1.787129e-09 1.261470e-09
[51] 8.904208e-10</code></pre>
</div>
</div>
</section>
<section id="effect-of-parameter-initialization" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="effect-of-parameter-initialization"><span class="header-section-number">2.3</span> Effect of parameter initialization</h2>
<p>According to how we initialize the HMM, we could get different results… Indeed, the Baum-Welch algorithm converges to a local solution which might not be the global optimum (i.e., according to the initial values of the matrices, we could get different results).</p>
<p>Hence, let us consider different initial parameterizations. In our first example we had considered states that were quite uncontrasted (there was only +10% chances of observing some wood in state H compared to state L). Alternatively, we could consider quite contrasted states (e.g.&nbsp;with +40% chances of observing some wood in state H compared to state L):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>M_CS<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>(pw<span class="fl">-0.40</span>),<span class="dv">1</span><span class="sc">-</span>(pw<span class="fl">+0.40</span>),pw<span class="fl">-0.40</span>,(pw<span class="fl">+0.40</span>)),<span class="dv">2</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_CS)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_CS)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"nothing"</span>,<span class="st">"wood"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(M_CS,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  nothing wood
L    0.93 0.07
H    0.13 0.87</code></pre>
</div>
</div>
<p>In our first example we also considered that there were few chances to change from one state from another, i.e.&nbsp;we used low transition probabilities. Alternatively, we could consider <strong>higher transition probabilities (HTP)</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>M_HTP<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(.<span class="dv">5</span>,.<span class="dv">5</span>,.<span class="dv">5</span>,.<span class="dv">5</span>),<span class="dv">2</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_HTP)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_HTP)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(M_HTP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    L   H
L 0.5 0.5
H 0.5 0.5</code></pre>
</div>
</div>
<p>Let’s initialize our HMM in various ways with matrices <code>M_LTP</code> vs <code>M_HTP</code> for transition probabilities and <code>M_CS</code> vs <code>M_UCS</code> for emission probabilities (i.e.&nbsp;4 possibilities):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FIRST CASE: starting from M_LTP and M_UCS</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>hmm_init_LTP_UCS <span class="ot">=</span> <span class="fu">initHMM</span>(<span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>),<span class="fu">c</span>(<span class="st">"nothing"</span>,<span class="st">"wood"</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transProbs=</span>M_LTP,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">emissionProbs=</span>M_UCS)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># SECOND CASE: starting from M_LTP and M_CS</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>hmm_init_LTP_CS <span class="ot">=</span> <span class="fu">initHMM</span>(<span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>),<span class="fu">c</span>(<span class="st">"nothing"</span>,<span class="st">"wood"</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transProbs=</span>M_LTP,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">emissionProbs=</span>M_CS)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># THIRD CASE: starting from M_HTP and M_UCS</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>hmm_init_HTP_UCS <span class="ot">=</span> <span class="fu">initHMM</span>(<span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>),<span class="fu">c</span>(<span class="st">"nothing"</span>,<span class="st">"wood"</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transProbs=</span>M_HTP,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">emissionProbs=</span>M_UCS)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># FOURTH CASE: starting from M_HTP and M_CS</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>hmm_init_HTP_CS <span class="ot">=</span> <span class="fu">initHMM</span>(<span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>),<span class="fu">c</span>(<span class="st">"nothing"</span>,<span class="st">"wood"</span>),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transProbs=</span>M_HTP,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">emissionProbs=</span>M_CS)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>list_hmm_init<span class="ot">=</span><span class="fu">list</span>(hmm_init_LTP_UCS,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                   hmm_init_LTP_CS,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                   hmm_init_HTP_UCS,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                   hmm_init_HTP_CS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the HMM are fitted (with various initial parameterizations):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>hmm_fit_LTP_UCS<span class="ot">=</span> <span class="fu">baumWelch</span>(hmm_init_LTP_UCS,obsWood)<span class="sc">$</span>hmm</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>hmm_fit_LTP_CS<span class="ot">=</span> <span class="fu">baumWelch</span>(hmm_init_LTP_CS,obsWood)<span class="sc">$</span>hmm</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>hmm_fit_HTP_UCS<span class="ot">=</span> <span class="fu">baumWelch</span>(hmm_init_HTP_UCS,obsWood)<span class="sc">$</span>hmm</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>hmm_fit_HTP_CS<span class="ot">=</span> <span class="fu">baumWelch</span>(hmm_init_HTP_CS,obsWood)<span class="sc">$</span>hmm</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>list_hmm_fit<span class="ot">=</span><span class="fu">list</span>(hmm_fit_LTP_UCS,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                  hmm_fit_LTP_CS,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                  hmm_fit_HTP_UCS,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                  hmm_fit_HTP_CS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are the transition matrices we get in the four cases:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit_LTP_UCS<span class="sc">$</span>transProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    to
from    L    H
   L 0.92 0.08
   H 0.10 0.90</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit_LTP_CS<span class="sc">$</span>transProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    to
from    L    H
   L 0.92 0.08
   H 0.10 0.90</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit_HTP_UCS<span class="sc">$</span>transProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    to
from    L    H
   L 0.92 0.08
   H 0.10 0.90</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit_HTP_CS<span class="sc">$</span>transProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    to
from    L    H
   L 0.92 0.08
   H 0.10 0.90</code></pre>
</div>
</div>
<p>Here are the emission matrices we get in the four cases:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit_LTP_UCS<span class="sc">$</span>emissionProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      symbols
states nothing wood
     L    0.90 0.10
     H    0.09 0.91</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit_LTP_CS<span class="sc">$</span>emissionProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      symbols
states nothing wood
     L    0.90 0.10
     H    0.09 0.91</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit_HTP_UCS<span class="sc">$</span>emissionProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      symbols
states nothing wood
     L    0.90 0.10
     H    0.09 0.91</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(hmm_fit_HTP_CS<span class="sc">$</span>emissionProbs,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      symbols
states nothing wood
     L    0.90 0.10
     H    0.09 0.91</code></pre>
</div>
</div>
<p>In this particular case, we have obtained the same fits with all initial parameterizations (which is actually reassuring as it implies that the optimum we get is a “not-so-local” optimum).</p>
<p>But if we had provided the Baum-Welch algorithm with a very different initial transition matrix (“VHTP” for “Very High Transition Probabilities”), e.g.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>M_VHTP<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(.<span class="dv">1</span>,.<span class="dv">9</span>,.<span class="dv">9</span>,.<span class="dv">1</span>),<span class="dv">2</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M_VHTP)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M_VHTP)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(M_VHTP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    L   H
L 0.1 0.9
H 0.9 0.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>hmm_init_VHTP_UCS <span class="ot">=</span> <span class="fu">initHMM</span>(<span class="fu">c</span>(<span class="st">"L"</span>,<span class="st">"H"</span>),<span class="fu">c</span>(<span class="st">"nothing"</span>,<span class="st">"wood"</span>),</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transProbs=</span>M_VHTP,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">emissionProbs=</span>M_UCS)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>hmm_fit_VHTP_UCS<span class="ot">=</span> <span class="fu">baumWelch</span>(hmm_init_VHTP_UCS,obsWood)<span class="sc">$</span>hmm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>then we would have got the following fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>hmm_fit_VHTP_UCS<span class="sc">$</span>transProbs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    to
from         L         H
   L 0.1005015 0.8994985
   H 0.8992563 0.1007437</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>hmm_fit_VHTP_UCS<span class="sc">$</span>emissionProbs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      symbols
states   nothing      wood
     L 0.5319157 0.4680843
     H 0.5319141 0.4680859</code></pre>
</div>
</div>
<p>This is actually a very peculiar way to initialize the transition matrix as it assumes that there are more chances of changing states at each time than of staying in the same state. With this parameterization, chances are the series of states is basically a succession of “L”-“H”-“L”-“H”-“L”-“H”… so that the two states are naturally quite uncontrasted in terms of outcome probabilities.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./hidden_states.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Predicting hidden states</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>